<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><a name="line-2"></a><span>
</span><a name="line-3"></a><span class="hs-comment">{-| Blockchain genesis. Not to be confused with genesis block in epoch.
    Blockchain genesis means genesis values which are hardcoded in advance
    (before system starts doing anything). Genesis block in epoch exists
    in every epoch and it's not known in advance.
-}</span><span>
</span><a name="line-8"></a><span>
</span><a name="line-9"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Pos</span><span class="hs-operator">.</span><span class="hs-identifier">Genesis</span><span>
</span><a name="line-10"></a><span>       </span><span class="hs-special">(</span><span>
</span><a name="line-11"></a><span>       </span><span class="hs-comment">-- * Static state</span><span>
</span><a name="line-12"></a><span>         </span><a href="Pos.Genesis.Types.html#StakeDistribution"><span class="hs-identifier hs-type">StakeDistribution</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-13"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Pos.Genesis.Types.html#GenesisData"><span class="hs-identifier hs-type">GenesisData</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-14"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Pos.Genesis.Parser.html#compileGenData"><span class="hs-identifier hs-var">compileGenData</span></a><span>
</span><a name="line-15"></a><span class="hs-cpp">#ifdef DEV_MODE</span><span>
</span><a name="line-16"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Pos.Genesis.html#genesisAddresses"><span class="hs-identifier hs-var">genesisAddresses</span></a><span>
</span><a name="line-17"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Pos.Genesis.html#genesisKeyPairs"><span class="hs-identifier hs-var">genesisKeyPairs</span></a><span>
</span><a name="line-18"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Pos.Genesis.html#genesisPublicKeys"><span class="hs-identifier hs-var">genesisPublicKeys</span></a><span>
</span><a name="line-19"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Pos.Genesis.html#genesisSecretKeys"><span class="hs-identifier hs-var">genesisSecretKeys</span></a><span>
</span><a name="line-20"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-21"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Pos.Genesis.html#genesisStakeDistribution"><span class="hs-identifier hs-var">genesisStakeDistribution</span></a><span>
</span><a name="line-22"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Pos.Genesis.html#genesisUtxo"><span class="hs-identifier hs-var">genesisUtxo</span></a><span>
</span><a name="line-23"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Pos.Genesis.html#genesisDelegation"><span class="hs-identifier hs-var">genesisDelegation</span></a><span>
</span><a name="line-24"></a><span>
</span><a name="line-25"></a><span>       </span><span class="hs-comment">-- * Ssc</span><span>
</span><a name="line-26"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Pos.Genesis.html#genesisLeaders"><span class="hs-identifier hs-var">genesisLeaders</span></a><span>
</span><a name="line-27"></a><span>
</span><a name="line-28"></a><span>       </span><span class="hs-comment">-- * Update System</span><span>
</span><a name="line-29"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Pos.Genesis.html#genesisBlockVersion"><span class="hs-identifier hs-var">genesisBlockVersion</span></a><span>
</span><a name="line-30"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Pos.Genesis.html#genesisBlockVersionData"><span class="hs-identifier hs-var">genesisBlockVersionData</span></a><span>
</span><a name="line-31"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Pos.Genesis.html#genesisSoftwareVersions"><span class="hs-identifier hs-var">genesisSoftwareVersions</span></a><span>
</span><a name="line-32"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Pos.Genesis.html#genesisScriptVersion"><span class="hs-identifier hs-var">genesisScriptVersion</span></a><span>
</span><a name="line-33"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Pos.Genesis.html#genesisSlotDuration"><span class="hs-identifier hs-var">genesisSlotDuration</span></a><span>
</span><a name="line-34"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Pos.Genesis.html#genesisMaxBlockSize"><span class="hs-identifier hs-var">genesisMaxBlockSize</span></a><span>
</span><a name="line-35"></a><span>       </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-36"></a><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Lens</span><span>               </span><span class="hs-special">(</span><span class="hs-identifier hs-var">_head</span><span class="hs-special">)</span><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Default</span><span>               </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Default</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span><span>                  </span><span class="hs-special">(</span><span class="hs-identifier hs-var">genericLength</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">genericReplicate</span><span class="hs-special">)</span><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Map</span><span class="hs-operator">.</span><span class="hs-identifier">Strict</span><span>            </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">M</span><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Text</span><span>                  </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">T</span><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Time</span><span class="hs-operator">.</span><span class="hs-identifier">Units</span><span>            </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Millisecond</span><span class="hs-special">)</span><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Formatting</span><span>                 </span><span class="hs-special">(</span><span class="hs-identifier hs-var">int</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">sformat</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">%</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Serokell</span><span class="hs-operator">.</span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Memory</span><span class="hs-operator">.</span><span class="hs-identifier">Units</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Byte</span><span class="hs-special">)</span><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Serokell</span><span class="hs-operator">.</span><span class="hs-identifier">Util</span><span>              </span><span class="hs-special">(</span><span class="hs-identifier hs-var">enumerate</span><span class="hs-special">)</span><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Universum</span><span>
</span><a name="line-47"></a><span>
</span><a name="line-48"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Pos.Constants.html"><span class="hs-identifier">Pos</span><span class="hs-operator">.</span><span class="hs-identifier">Constants</span></a><span>              </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Const</span><span>
</span><a name="line-49"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Pos</span><span class="hs-operator">.</span><span class="hs-identifier">Crypto</span><span>                 </span><span class="hs-special">(</span><span class="hs-identifier hs-type">PublicKey</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">SecretKey</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">deterministicKeyGen</span><span class="hs-special">,</span><span>
</span><a name="line-50"></a><span>                                             </span><span class="hs-identifier hs-var">unsafeHash</span><span class="hs-special">)</span><span>
</span><a name="line-51"></a><span class="hs-keyword">import</span><span>           </span><a href="Pos.Genesis.Parser.html"><span class="hs-identifier">Pos</span><span class="hs-operator">.</span><span class="hs-identifier">Genesis</span><span class="hs-operator">.</span><span class="hs-identifier">Parser</span></a><span>         </span><span class="hs-special">(</span><a href="Pos.Genesis.Parser.html#compileGenData"><span class="hs-identifier hs-var">compileGenData</span></a><span class="hs-special">)</span><span>
</span><a name="line-52"></a><span class="hs-keyword">import</span><span>           </span><a href="Pos.Genesis.Types.html"><span class="hs-identifier">Pos</span><span class="hs-operator">.</span><span class="hs-identifier">Genesis</span><span class="hs-operator">.</span><span class="hs-identifier">Types</span></a><span>          </span><span class="hs-special">(</span><a href="Pos.Genesis.Types.html#GenesisData"><span class="hs-identifier hs-type">GenesisData</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Pos.Genesis.Types.html#StakeDistribution"><span class="hs-identifier hs-type">StakeDistribution</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-53"></a><span class="hs-keyword">import</span><span>           </span><a href="Pos.Lrc.FollowTheSatoshi.html"><span class="hs-identifier">Pos</span><span class="hs-operator">.</span><span class="hs-identifier">Lrc</span><span class="hs-operator">.</span><span class="hs-identifier">FollowTheSatoshi</span></a><span>   </span><span class="hs-special">(</span><a href="Pos.Lrc.FollowTheSatoshi.html#followTheSatoshi"><span class="hs-identifier hs-var">followTheSatoshi</span></a><span class="hs-special">)</span><span>
</span><a name="line-54"></a><span class="hs-keyword">import</span><span>           </span><a href="Pos.Txp.Core.Types.html"><span class="hs-identifier">Pos</span><span class="hs-operator">.</span><span class="hs-identifier">Txp</span><span class="hs-operator">.</span><span class="hs-identifier">Core</span><span class="hs-operator">.</span><span class="hs-identifier">Types</span></a><span>         </span><span class="hs-special">(</span><a href="Pos.Txp.Core.Types.html#TxIn"><span class="hs-identifier hs-type">TxIn</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Pos.Txp.Core.Types.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Pos.Txp.Core.Types.html#Utxo"><span class="hs-identifier hs-type">Utxo</span></a><span class="hs-special">)</span><span>
</span><a name="line-55"></a><span class="hs-keyword">import</span><span>           </span><a href="Pos.Types.html"><span class="hs-identifier">Pos</span><span class="hs-operator">.</span><span class="hs-identifier">Types</span></a><span>                  </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Address</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">BlockVersion</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Coin</span><span class="hs-special">,</span><span>
</span><a name="line-56"></a><span>                                             </span><span class="hs-identifier hs-type">SharedSeed</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SharedSeed</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">SlotLeaders</span><span class="hs-special">,</span><span>
</span><a name="line-57"></a><span>                                             </span><span class="hs-identifier hs-type">StakeholderId</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">applyCoinPortion</span><span class="hs-special">,</span><span>
</span><a name="line-58"></a><span>                                             </span><span class="hs-identifier hs-var">coinToInteger</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">divCoin</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">makePubKeyAddress</span><span class="hs-special">,</span><span>
</span><a name="line-59"></a><span>                                             </span><span class="hs-identifier hs-var">mkCoin</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">unsafeAddCoin</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">unsafeMulCoin</span><span class="hs-special">)</span><span>
</span><a name="line-60"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Pos</span><span class="hs-operator">.</span><span class="hs-identifier">Types</span><span class="hs-operator">.</span><span class="hs-identifier">Script</span><span>           </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ScriptVersion</span><span class="hs-special">)</span><span>
</span><a name="line-61"></a><span class="hs-keyword">import</span><span>           </span><a href="Pos.Types.Version.html"><span class="hs-identifier">Pos</span><span class="hs-operator">.</span><span class="hs-identifier">Types</span><span class="hs-operator">.</span><span class="hs-identifier">Version</span></a><span>          </span><span class="hs-special">(</span><span class="hs-identifier hs-type">SoftwareVersion</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-62"></a><span class="hs-keyword">import</span><span>           </span><a href="Pos.Update.Core.Types.html"><span class="hs-identifier">Pos</span><span class="hs-operator">.</span><span class="hs-identifier">Update</span><span class="hs-operator">.</span><span class="hs-identifier">Core</span><span class="hs-operator">.</span><span class="hs-identifier">Types</span></a><span>      </span><span class="hs-special">(</span><a href="Pos.Update.Core.Types.html#BlockVersionData"><span class="hs-identifier hs-type">BlockVersionData</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-63"></a><span>
</span><a name="line-64"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-65"></a><span class="hs-comment">-- Static state</span><span>
</span><a name="line-66"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-67"></a><span>
</span><a name="line-68"></a><span class="hs-cpp">#ifdef DEV_MODE</span><span>
</span><a name="line-69"></a><span class="hs-comment">-- | List of pairs from 'SecretKey' with corresponding 'PublicKey'.</span><span>
</span><a name="line-70"></a><span class="hs-identifier">genesisKeyPairs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">PublicKey</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">SecretKey</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-71"></a><a name="genesisKeyPairs"><a href="Pos.Genesis.html#genesisKeyPairs"><span class="hs-identifier">genesisKeyPairs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621680373160"><span class="hs-identifier hs-var">gen</span></a><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span> </span><span class="hs-glyph">..</span><span> </span><a href="Pos.Constants.html#genesisN"><span class="hs-identifier hs-var">Const</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">genesisN</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">]</span><span>
</span><a name="line-72"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-73"></a><span>    </span><span class="hs-identifier">gen</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">PublicKey</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">SecretKey</span><span class="hs-special">)</span><span>
</span><a name="line-74"></a><span>    </span><a name="local-6989586621680373160"><a href="#local-6989586621680373160"><span class="hs-identifier">gen</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-75"></a><span>        </span><span class="hs-identifier hs-var">fromMaybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;deterministicKeyGen failed in Genesis&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span>
</span><a name="line-76"></a><span>        </span><span class="hs-identifier hs-var">deterministicKeyGen</span><span> </span><span class="hs-operator hs-var">.</span><span>
</span><a name="line-77"></a><span>        </span><span class="hs-identifier hs-var">encodeUtf8</span><span> </span><span class="hs-operator hs-var">.</span><span>
</span><a name="line-78"></a><span>        </span><span class="hs-identifier hs-var">T</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">take</span><span> </span><span class="hs-number">32</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">sformat</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;My awesome 32-byte seed #&quot;</span><span> </span><span class="hs-operator hs-var">%</span><span class="hs-identifier hs-var">int</span><span> </span><span class="hs-operator hs-var">%</span><span> </span><span class="hs-string">&quot;             &quot;</span><span class="hs-special">)</span><span>
</span><a name="line-79"></a><span>
</span><a name="line-80"></a><span class="hs-comment">-- | List of 'SecrekKey'`s in genesis.</span><span>
</span><a name="line-81"></a><span class="hs-identifier">genesisSecretKeys</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">SecretKey</span><span class="hs-special">]</span><span>
</span><a name="line-82"></a><a name="genesisSecretKeys"><a href="Pos.Genesis.html#genesisSecretKeys"><span class="hs-identifier">genesisSecretKeys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><a href="Pos.Genesis.html#genesisKeyPairs"><span class="hs-identifier hs-var">genesisKeyPairs</span></a><span>
</span><a name="line-83"></a><span>
</span><a name="line-84"></a><span class="hs-comment">-- | List of 'PublicKey'`s in genesis.</span><span>
</span><a name="line-85"></a><span class="hs-identifier">genesisPublicKeys</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">PublicKey</span><span class="hs-special">]</span><span>
</span><a name="line-86"></a><a name="genesisPublicKeys"><a href="Pos.Genesis.html#genesisPublicKeys"><span class="hs-identifier">genesisPublicKeys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><a href="Pos.Genesis.html#genesisKeyPairs"><span class="hs-identifier hs-var">genesisKeyPairs</span></a><span>
</span><a name="line-87"></a><span>
</span><a name="line-88"></a><span class="hs-comment">-- | List of 'Address'`es in genesis. See 'genesisPublicKeys'.</span><span>
</span><a name="line-89"></a><span class="hs-identifier">genesisAddresses</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Address</span><span class="hs-special">]</span><span>
</span><a name="line-90"></a><a name="genesisAddresses"><a href="Pos.Genesis.html#genesisAddresses"><span class="hs-identifier">genesisAddresses</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">makePubKeyAddress</span><span> </span><a href="Pos.Genesis.html#genesisPublicKeys"><span class="hs-identifier hs-var">genesisPublicKeys</span></a><span>
</span><a name="line-91"></a><span>
</span><a name="line-92"></a><span class="hs-identifier">genesisStakeDistribution</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Pos.Genesis.Types.html#StakeDistribution"><span class="hs-identifier hs-type">StakeDistribution</span></a><span>
</span><a name="line-93"></a><a name="genesisStakeDistribution"><a href="Pos.Genesis.html#genesisStakeDistribution"><span class="hs-identifier">genesisStakeDistribution</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">def</span><span>
</span><a name="line-94"></a><span class="hs-cpp">#else</span><span>
</span><a name="line-95"></a><span class="hs-identifier">genesisAddresses</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Address</span><span class="hs-special">]</span><span>
</span><a name="line-96"></a><span class="hs-identifier">genesisAddresses</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">gdAddresses</span><span> </span><span class="hs-identifier">compileGenData</span><span>
</span><a name="line-97"></a><span>
</span><a name="line-98"></a><span class="hs-identifier">genesisStakeDistribution</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">StakeDistribution</span><span>
</span><a name="line-99"></a><span class="hs-identifier">genesisStakeDistribution</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">gdDistribution</span><span> </span><span class="hs-identifier">compileGenData</span><span>
</span><a name="line-100"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-101"></a><span>
</span><a name="line-102"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Default</span><span> </span><a href="Pos.Genesis.Types.html#StakeDistribution"><span class="hs-identifier hs-type">StakeDistribution</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-103"></a><span>    </span><a name="local-8214565720323817142"><span class="hs-identifier">def</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pos.Genesis.Types.html#FlatStakes"><span class="hs-identifier hs-var">FlatStakes</span></a><span> </span><a href="Pos.Constants.html#genesisN"><span class="hs-identifier hs-var">Const</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">genesisN</span></a><span>
</span><a name="line-104"></a><span>              </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkCoin</span><span> </span><span class="hs-number">10000</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">unsafeMulCoin</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="Pos.Constants.html#genesisN"><span class="hs-identifier hs-var">Const</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">genesisN</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-105"></a><span>
</span><a name="line-106"></a><span class="hs-comment">-- 10000 coins in total. For thresholds testing.</span><span>
</span><a name="line-107"></a><span class="hs-comment">-- 0.5,0.25,0.125,0.0625,0.0312,0.0156,0.0078,0.0039,0.0019,0.0008,0.0006,0.0004,0.0002,0.0001</span><span>
</span><a name="line-108"></a><span class="hs-identifier">expTwoDistribution</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Coin</span><span class="hs-special">]</span><span>
</span><a name="line-109"></a><a name="expTwoDistribution"><a href="Pos.Genesis.html#expTwoDistribution"><span class="hs-identifier">expTwoDistribution</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-110"></a><span>    </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">mkCoin</span><span> </span><span class="hs-special">[</span><span class="hs-number">5000</span><span class="hs-special">,</span><span class="hs-number">2500</span><span class="hs-special">,</span><span class="hs-number">1250</span><span class="hs-special">,</span><span class="hs-number">625</span><span class="hs-special">,</span><span class="hs-number">312</span><span class="hs-special">,</span><span class="hs-number">156</span><span class="hs-special">,</span><span class="hs-number">78</span><span class="hs-special">,</span><span class="hs-number">39</span><span class="hs-special">,</span><span class="hs-number">19</span><span class="hs-special">,</span><span class="hs-number">8</span><span class="hs-special">,</span><span class="hs-number">6</span><span class="hs-special">,</span><span class="hs-number">4</span><span class="hs-special">,</span><span class="hs-number">2</span><span class="hs-special">,</span><span class="hs-number">1</span><span class="hs-special">]</span><span>
</span><a name="line-111"></a><span>
</span><a name="line-112"></a><span class="hs-identifier">bitcoinDistribution20</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Coin</span><span class="hs-special">]</span><span>
</span><a name="line-113"></a><a name="bitcoinDistribution20"><a href="Pos.Genesis.html#bitcoinDistribution20"><span class="hs-identifier">bitcoinDistribution20</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">mkCoin</span><span>
</span><a name="line-114"></a><span>    </span><span class="hs-special">[</span><span class="hs-number">200</span><span class="hs-special">,</span><span class="hs-number">163</span><span class="hs-special">,</span><span class="hs-number">120</span><span class="hs-special">,</span><span class="hs-number">105</span><span class="hs-special">,</span><span class="hs-number">78</span><span class="hs-special">,</span><span class="hs-number">76</span><span class="hs-special">,</span><span class="hs-number">57</span><span class="hs-special">,</span><span class="hs-number">50</span><span class="hs-special">,</span><span class="hs-number">46</span><span class="hs-special">,</span><span class="hs-number">31</span><span class="hs-special">,</span><span class="hs-number">26</span><span class="hs-special">,</span><span class="hs-number">13</span><span class="hs-special">,</span><span class="hs-number">11</span><span class="hs-special">,</span><span class="hs-number">11</span><span class="hs-special">,</span><span class="hs-number">7</span><span class="hs-special">,</span><span class="hs-number">4</span><span class="hs-special">,</span><span class="hs-number">2</span><span class="hs-special">,</span><span class="hs-number">0</span><span class="hs-special">,</span><span class="hs-number">0</span><span class="hs-special">,</span><span class="hs-number">0</span><span class="hs-special">]</span><span>
</span><a name="line-115"></a><span>
</span><a name="line-116"></a><span class="hs-identifier">stakeDistribution</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Pos.Genesis.Types.html#StakeDistribution"><span class="hs-identifier hs-type">StakeDistribution</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Coin</span><span class="hs-special">]</span><span>
</span><a name="line-117"></a><a name="stakeDistribution"><a href="Pos.Genesis.html#stakeDistribution"><span class="hs-identifier">stakeDistribution</span></a></a><span> </span><span class="hs-special">(</span><a href="Pos.Genesis.Types.html#FlatStakes"><span class="hs-identifier hs-var">FlatStakes</span></a><span> </span><a name="local-6989586621680373161"><a href="#local-6989586621680373161"><span class="hs-identifier">stakeholders</span></a></a><span> </span><a name="local-6989586621680373162"><a href="#local-6989586621680373162"><span class="hs-identifier">coins</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-118"></a><span>    </span><span class="hs-identifier hs-var">genericReplicate</span><span> </span><a href="#local-6989586621680373161"><span class="hs-identifier hs-var">stakeholders</span></a><span> </span><a href="#local-6989586621680373163"><span class="hs-identifier hs-var">val</span></a><span>
</span><a name="line-119"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-120"></a><span>    </span><a name="local-6989586621680373163"><a href="#local-6989586621680373163"><span class="hs-identifier">val</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680373162"><span class="hs-identifier hs-var">coins</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">divCoin</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680373161"><span class="hs-identifier hs-var">stakeholders</span></a><span>
</span><a name="line-121"></a><span class="hs-identifier">stakeDistribution</span><span> </span><span class="hs-special">(</span><a href="Pos.Genesis.Types.html#BitcoinStakes"><span class="hs-identifier hs-var">BitcoinStakes</span></a><span> </span><a name="local-6989586621680373164"><a href="#local-6989586621680373164"><span class="hs-identifier">stakeholders</span></a></a><span> </span><a name="local-6989586621680373165"><a href="#local-6989586621680373165"><span class="hs-identifier">coins</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-122"></a><span>    </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621680373166"><span class="hs-identifier hs-var">normalize</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Pos.Genesis.html#bitcoinDistribution1000Coins"><span class="hs-identifier hs-var">bitcoinDistribution1000Coins</span></a><span> </span><a href="#local-6989586621680373164"><span class="hs-identifier hs-var">stakeholders</span></a><span>
</span><a name="line-123"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-124"></a><span>    </span><a name="local-6989586621680373166"><a href="#local-6989586621680373166"><span class="hs-identifier">normalize</span></a></a><span> </span><a name="local-6989586621680373167"><a href="#local-6989586621680373167"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680373167"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">unsafeMulCoin</span><span class="hs-special">`</span><span>
</span><a name="line-125"></a><span>                  </span><span class="hs-identifier hs-var">coinToInteger</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680373165"><span class="hs-identifier hs-var">coins</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">divCoin</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-number">1000</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-126"></a><span class="hs-identifier">stakeDistribution</span><span> </span><a href="Pos.Genesis.Types.html#ExponentialStakes"><span class="hs-identifier hs-var">ExponentialStakes</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pos.Genesis.html#expTwoDistribution"><span class="hs-identifier hs-var">expTwoDistribution</span></a><span>
</span><a name="line-127"></a><span class="hs-identifier">stakeDistribution</span><span> </span><a href="Pos.Genesis.Types.html#TestnetStakes"><span class="hs-identifier hs-var">TestnetStakes</span></a><span> </span><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-128"></a><span>    </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkCoin</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621680373181"><span class="hs-identifier hs-var">basicDist</span></a><span> </span><span class="hs-operator hs-var">&amp;</span><span> </span><span class="hs-identifier hs-var">_head</span><span> </span><span class="hs-operator hs-var">%~</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621680373180"><span class="hs-identifier hs-var">rmd</span></a><span class="hs-special">)</span><span>
</span><a name="line-129"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-130"></a><span>    </span><span class="hs-comment">-- Total number of richmen</span><span>
</span><a name="line-131"></a><span>    </span><a name="local-6989586621680373171"><a href="#local-6989586621680373171"><span class="hs-identifier">richs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621680373169"><span class="hs-identifier hs-var">sdRichmen</span></a><span>
</span><a name="line-132"></a><span>    </span><span class="hs-comment">-- Total number of poor</span><span>
</span><a name="line-133"></a><span>    </span><a name="local-6989586621680373172"><a href="#local-6989586621680373172"><span class="hs-identifier">poors</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621680373170"><span class="hs-identifier hs-var">sdPoor</span></a><span>
</span><a name="line-134"></a><span>    </span><span class="hs-comment">-- Minimum amount of money to become rich</span><span>
</span><a name="line-135"></a><span>    </span><a name="local-6989586621680373173"><a href="#local-6989586621680373173"><span class="hs-identifier">thresholdRich</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">coinToInteger</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-136"></a><span>        </span><span class="hs-identifier hs-var">applyCoinPortion</span><span> </span><a href="Pos.Constants.html#genesisMpcThd"><span class="hs-identifier hs-var">Const</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">genesisMpcThd</span></a><span> </span><a href="#local-6989586621680373168"><span class="hs-identifier hs-var">sdTotalStake</span></a><span>
</span><a name="line-137"></a><span>    </span><span class="hs-comment">-- Maximal amount of total money which poor stakeholders can hold</span><span>
</span><a name="line-138"></a><span>    </span><a name="local-6989586621680373174"><a href="#local-6989586621680373174"><span class="hs-identifier">maxPoorStake</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680373173"><span class="hs-identifier hs-var">thresholdRich</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="#local-6989586621680373172"><span class="hs-identifier hs-var">poors</span></a><span>
</span><a name="line-139"></a><span>    </span><span class="hs-comment">-- Minimum amount of richmen's money to prevent poors becoming richmen</span><span>
</span><a name="line-140"></a><span>    </span><a name="local-6989586621680373175"><a href="#local-6989586621680373175"><span class="hs-identifier">minRichStake</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">coinToInteger</span><span> </span><a href="#local-6989586621680373168"><span class="hs-identifier hs-var">sdTotalStake</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621680373174"><span class="hs-identifier hs-var">maxPoorStake</span></a><span>
</span><a name="line-141"></a><span>    </span><span class="hs-comment">-- Minimum amount of money per richman to maintain number of richmen</span><span>
</span><a name="line-142"></a><span>    </span><a name="local-6989586621680373176"><a href="#local-6989586621680373176"><span class="hs-identifier">minRich</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680373175"><span class="hs-identifier hs-var">minRichStake</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">div</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680373171"><span class="hs-identifier hs-var">richs</span></a><span>
</span><a name="line-143"></a><span>    </span><span class="hs-comment">-- Final amount of money per richman</span><span>
</span><a name="line-144"></a><span>    </span><a name="local-6989586621680373177"><a href="#local-6989586621680373177"><span class="hs-identifier">rich</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">max</span><span> </span><a href="#local-6989586621680373173"><span class="hs-identifier hs-var">thresholdRich</span></a><span> </span><a href="#local-6989586621680373176"><span class="hs-identifier hs-var">minRich</span></a><span>
</span><a name="line-145"></a><span>    </span><span class="hs-comment">-- Amount of money left to poor</span><span>
</span><a name="line-146"></a><span>    </span><a name="local-6989586621680373178"><a href="#local-6989586621680373178"><span class="hs-identifier">poorStake</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">coinToInteger</span><span> </span><a href="#local-6989586621680373168"><span class="hs-identifier hs-var">sdTotalStake</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621680373171"><span class="hs-identifier hs-var">richs</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="#local-6989586621680373177"><span class="hs-identifier hs-var">rich</span></a><span>
</span><a name="line-147"></a><span>    </span><span class="hs-comment">-- Money per poor and modulo (it goes to first richman)</span><span>
</span><a name="line-148"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621680373179"><a href="#local-6989586621680373179"><span class="hs-identifier">poor</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680373180"><a href="#local-6989586621680373180"><span class="hs-identifier">rmd</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621680373172"><span class="hs-identifier hs-var">poors</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-149"></a><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="hs-number">0</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621680373178"><span class="hs-identifier hs-var">poorStake</span></a><span class="hs-special">)</span><span>
</span><a name="line-150"></a><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680373178"><span class="hs-identifier hs-var">poorStake</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">div</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680373172"><span class="hs-identifier hs-var">poors</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680373178"><span class="hs-identifier hs-var">poorStake</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mod</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680373172"><span class="hs-identifier hs-var">poors</span></a><span class="hs-special">)</span><span>
</span><a name="line-151"></a><span>    </span><span class="hs-comment">-- Coin distribution (w/o modulo added)</span><span>
</span><a name="line-152"></a><span>    </span><a name="local-6989586621680373181"><a href="#local-6989586621680373181"><span class="hs-identifier">basicDist</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">genericReplicate</span><span> </span><a href="#local-6989586621680373171"><span class="hs-identifier hs-var">richs</span></a><span> </span><a href="#local-6989586621680373177"><span class="hs-identifier hs-var">rich</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">genericReplicate</span><span> </span><a href="#local-6989586621680373172"><span class="hs-identifier hs-var">poors</span></a><span> </span><a href="#local-6989586621680373179"><span class="hs-identifier hs-var">poor</span></a><span>
</span><a name="line-153"></a><span class="hs-identifier">stakeDistribution</span><span> </span><span class="hs-special">(</span><a href="Pos.Genesis.Types.html#ExplicitStakes"><span class="hs-identifier hs-var">ExplicitStakes</span></a><span> </span><a name="local-6989586621680373280"><a href="#local-6989586621680373280"><span class="hs-identifier">balances</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-154"></a><span>    </span><span class="hs-identifier hs-var">toList</span><span> </span><a href="#local-6989586621680373280"><span class="hs-identifier hs-var">balances</span></a><span>
</span><a name="line-155"></a><span>
</span><a name="line-156"></a><span class="hs-identifier">bitcoinDistribution1000Coins</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Coin</span><span class="hs-special">]</span><span>
</span><a name="line-157"></a><a name="bitcoinDistribution1000Coins"><a href="Pos.Genesis.html#bitcoinDistribution1000Coins"><span class="hs-identifier">bitcoinDistribution1000Coins</span></a></a><span> </span><a name="local-6989586621680373281"><a href="#local-6989586621680373281"><span class="hs-identifier">stakeholders</span></a></a><span>
</span><a name="line-158"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680373281"><span class="hs-identifier hs-var">stakeholders</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-number">20</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pos.Genesis.html#stakeDistribution"><span class="hs-identifier hs-var">stakeDistribution</span></a><span>
</span><a name="line-159"></a><span>          </span><span class="hs-special">(</span><a href="Pos.Genesis.Types.html#FlatStakes"><span class="hs-identifier hs-var">FlatStakes</span></a><span> </span><a href="#local-6989586621680373281"><span class="hs-identifier hs-var">stakeholders</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkCoin</span><span> </span><span class="hs-number">1000</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-160"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680373281"><span class="hs-identifier hs-var">stakeholders</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">20</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pos.Genesis.html#bitcoinDistribution20"><span class="hs-identifier hs-var">bitcoinDistribution20</span></a><span>
</span><a name="line-161"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-162"></a><span>        </span><span class="hs-identifier hs-var">foldl'</span><span> </span><span class="hs-special">(</span><a href="Pos.Genesis.html#bitcoinDistributionImpl"><span class="hs-identifier hs-var">bitcoinDistributionImpl</span></a><span> </span><a href="#local-6989586621680373282"><span class="hs-identifier hs-var">ratio</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-163"></a><span>        </span><span class="hs-identifier hs-var">enumerate</span><span> </span><a href="Pos.Genesis.html#bitcoinDistribution20"><span class="hs-identifier hs-var">bitcoinDistribution20</span></a><span>
</span><a name="line-164"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-165"></a><span>    </span><a name="local-6989586621680373282"><a href="#local-6989586621680373282"><span class="hs-identifier">ratio</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621680373281"><span class="hs-identifier hs-var">stakeholders</span></a><span> </span><span class="hs-operator hs-var">/</span><span> </span><span class="hs-number">20</span><span>
</span><a name="line-166"></a><span>
</span><a name="line-167"></a><span class="hs-identifier">bitcoinDistributionImpl</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Double</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Coin</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Coin</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Coin</span><span class="hs-special">]</span><span>
</span><a name="line-168"></a><a name="bitcoinDistributionImpl"><a href="Pos.Genesis.html#bitcoinDistributionImpl"><span class="hs-identifier">bitcoinDistributionImpl</span></a></a><span> </span><a name="local-6989586621680373290"><a href="#local-6989586621680373290"><span class="hs-identifier">ratio</span></a></a><span> </span><a name="local-6989586621680373291"><a href="#local-6989586621680373291"><span class="hs-identifier">coins</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680373292"><a href="#local-6989586621680373292"><span class="hs-identifier">coinIdx</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680373293"><a href="#local-6989586621680373293"><span class="hs-identifier">coin</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-169"></a><span>    </span><a href="#local-6989586621680373291"><span class="hs-identifier hs-var">coins</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621680373298"><span class="hs-identifier hs-var">toAddValMax</span></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier hs-var">replicate</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680373296"><span class="hs-identifier hs-var">toAddNum</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680373297"><span class="hs-identifier hs-var">toAddValMin</span></a><span>
</span><a name="line-170"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-171"></a><span>    </span><a name="local-6989586621680373294"><a href="#local-6989586621680373294"><span class="hs-identifier">toAddNumMax</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ceiling</span><span> </span><a href="#local-6989586621680373290"><span class="hs-identifier hs-var">ratio</span></a><span>
</span><a name="line-172"></a><span>    </span><a name="local-6989586621680373295"><a href="#local-6989586621680373295"><span class="hs-identifier">toAddNumMin</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">floor</span><span> </span><a href="#local-6989586621680373290"><span class="hs-identifier hs-var">ratio</span></a><span>
</span><a name="line-173"></a><span>    </span><span class="hs-identifier">toAddNum</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-174"></a><span>    </span><a name="local-6989586621680373296"><a href="#local-6989586621680373296"><span class="hs-identifier">toAddNum</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-175"></a><span>        </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">genericLength</span><span> </span><a href="#local-6989586621680373291"><span class="hs-identifier hs-var">coins</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-identifier hs-var">realToFrac</span><span> </span><a href="#local-6989586621680373294"><span class="hs-identifier hs-var">toAddNumMax</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span>
</span><a name="line-176"></a><span>           </span><span class="hs-identifier hs-var">realToFrac</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680373292"><span class="hs-identifier hs-var">coinIdx</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="#local-6989586621680373290"><span class="hs-identifier hs-var">ratio</span></a><span>
</span><a name="line-177"></a><span>            </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621680373295"><span class="hs-identifier hs-var">toAddNumMin</span></a><span>
</span><a name="line-178"></a><span>            </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621680373294"><span class="hs-identifier hs-var">toAddNumMax</span></a><span>
</span><a name="line-179"></a><span>    </span><a name="local-6989586621680373297"><a href="#local-6989586621680373297"><span class="hs-identifier">toAddValMin</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680373293"><span class="hs-identifier hs-var">coin</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">divCoin</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680373296"><span class="hs-identifier hs-var">toAddNum</span></a><span>
</span><a name="line-180"></a><span>    </span><a name="local-6989586621680373298"><a href="#local-6989586621680373298"><span class="hs-identifier">toAddValMax</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680373293"><span class="hs-identifier hs-var">coin</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">unsafeAddCoin</span><span class="hs-special">`</span><span>
</span><a name="line-181"></a><span>                  </span><span class="hs-special">(</span><a href="#local-6989586621680373297"><span class="hs-identifier hs-var">toAddValMin</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">unsafeMulCoin</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680373296"><span class="hs-identifier hs-var">toAddNum</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-182"></a><span>
</span><a name="line-183"></a><span class="hs-comment">-- | Genesis 'Utxo'.</span><span>
</span><a name="line-184"></a><span class="hs-identifier">genesisUtxo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Pos.Genesis.Types.html#StakeDistribution"><span class="hs-identifier hs-type">StakeDistribution</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Pos.Txp.Core.Types.html#Utxo"><span class="hs-identifier hs-type">Utxo</span></a><span>
</span><a name="line-185"></a><a name="genesisUtxo"><a href="Pos.Genesis.html#genesisUtxo"><span class="hs-identifier">genesisUtxo</span></a></a><span> </span><a name="local-6989586621680373299"><a href="#local-6989586621680373299"><span class="hs-identifier">sd</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-186"></a><span>    </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">zipWith</span><span> </span><a href="#local-6989586621680373300"><span class="hs-identifier hs-var">zipF</span></a><span> </span><span class="hs-special">(</span><a href="Pos.Genesis.html#stakeDistribution"><span class="hs-identifier hs-var">stakeDistribution</span></a><span> </span><a href="#local-6989586621680373299"><span class="hs-identifier hs-var">sd</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Pos.Genesis.html#genesisAddresses"><span class="hs-identifier hs-var">genesisAddresses</span></a><span>
</span><a name="line-187"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-188"></a><span>    </span><a name="local-6989586621680373300"><a href="#local-6989586621680373300"><span class="hs-identifier">zipF</span></a></a><span> </span><a name="local-6989586621680373301"><a href="#local-6989586621680373301"><span class="hs-identifier">coin</span></a></a><span> </span><a name="local-6989586621680373302"><a href="#local-6989586621680373302"><span class="hs-identifier">addr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Pos.Txp.Core.Types.html#TxIn"><span class="hs-identifier hs-var">TxIn</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unsafeHash</span><span> </span><a href="#local-6989586621680373302"><span class="hs-identifier hs-var">addr</span></a><span class="hs-special">)</span><span> </span><span class="hs-number">0</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="Pos.Txp.Core.Types.html#TxOut"><span class="hs-identifier hs-var">TxOut</span></a><span> </span><a href="#local-6989586621680373302"><span class="hs-identifier hs-var">addr</span></a><span> </span><a href="#local-6989586621680373301"><span class="hs-identifier hs-var">coin</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-189"></a><span>
</span><a name="line-190"></a><span class="hs-identifier">genesisDelegation</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HashMap</span><span> </span><span class="hs-identifier hs-type">StakeholderId</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">StakeholderId</span><span class="hs-special">]</span><span>
</span><a name="line-191"></a><a name="genesisDelegation"><a href="Pos.Genesis.html#genesisDelegation"><span class="hs-identifier">genesisDelegation</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-192"></a><span>
</span><a name="line-193"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-194"></a><span class="hs-comment">-- Slot leaders</span><span>
</span><a name="line-195"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-196"></a><span>
</span><a name="line-197"></a><span class="hs-identifier">genesisSeed</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">SharedSeed</span><span>
</span><a name="line-198"></a><a name="genesisSeed"><a href="Pos.Genesis.html#genesisSeed"><span class="hs-identifier">genesisSeed</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">SharedSeed</span><span> </span><span class="hs-string">&quot;vasa opasa skovoroda Ggurda boroda provoda&quot;</span><span>
</span><a name="line-199"></a><span>
</span><a name="line-200"></a><span class="hs-comment">-- | Leaders of genesis. See 'followTheSatoshi'.</span><span>
</span><a name="line-201"></a><span class="hs-identifier">genesisLeaders</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Pos.Txp.Core.Types.html#Utxo"><span class="hs-identifier hs-type">Utxo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SlotLeaders</span><span>
</span><a name="line-202"></a><a name="genesisLeaders"><a href="Pos.Genesis.html#genesisLeaders"><span class="hs-identifier">genesisLeaders</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pos.Lrc.FollowTheSatoshi.html#followTheSatoshi"><span class="hs-identifier hs-var">followTheSatoshi</span></a><span> </span><a href="Pos.Genesis.html#genesisSeed"><span class="hs-identifier hs-var">genesisSeed</span></a><span>
</span><a name="line-203"></a><span>
</span><a name="line-204"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-205"></a><span class="hs-comment">-- Update system</span><span>
</span><a name="line-206"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-207"></a><span>
</span><a name="line-208"></a><span class="hs-comment">-- | BlockVersion used at the very beginning.</span><span>
</span><a name="line-209"></a><span class="hs-identifier">genesisBlockVersion</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">BlockVersion</span><span>
</span><a name="line-210"></a><a name="genesisBlockVersion"><a href="Pos.Genesis.html#genesisBlockVersion"><span class="hs-identifier">genesisBlockVersion</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-211"></a><span>    </span><span class="hs-identifier hs-var">BlockVersion</span><span>
</span><a name="line-212"></a><span>    </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">bvMajor</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-213"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">bvMinor</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-214"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">bvAlt</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-215"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-216"></a><span>
</span><a name="line-217"></a><span class="hs-comment">-- | Software Versions</span><span>
</span><a name="line-218"></a><span class="hs-identifier">genesisSoftwareVersions</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">SoftwareVersion</span><span class="hs-special">]</span><span>
</span><a name="line-219"></a><a name="genesisSoftwareVersions"><a href="Pos.Genesis.html#genesisSoftwareVersions"><span class="hs-identifier">genesisSoftwareVersions</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="Pos.Constants.html#curSoftwareVersion"><span class="hs-identifier hs-var">Const</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">curSoftwareVersion</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">svNumber</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-special">}</span><span class="hs-special">]</span><span>
</span><a name="line-220"></a><span>
</span><a name="line-221"></a><span class="hs-comment">-- | 'BlockVersionData' for genesis 'BlockVersion'.</span><span>
</span><a name="line-222"></a><span class="hs-identifier">genesisBlockVersionData</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Pos.Update.Core.Types.html#BlockVersionData"><span class="hs-identifier hs-type">BlockVersionData</span></a><span>
</span><a name="line-223"></a><a name="genesisBlockVersionData"><a href="Pos.Genesis.html#genesisBlockVersionData"><span class="hs-identifier">genesisBlockVersionData</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-224"></a><span>    </span><a href="Pos.Update.Core.Types.html#BlockVersionData"><span class="hs-identifier hs-var">BlockVersionData</span></a><span>
</span><a name="line-225"></a><span>    </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">bvdScriptVersion</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pos.Genesis.html#genesisScriptVersion"><span class="hs-identifier hs-var">genesisScriptVersion</span></a><span>
</span><a name="line-226"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">bvdSlotDuration</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pos.Constants.html#genesisSlotDuration"><span class="hs-identifier hs-var">Const</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">genesisSlotDuration</span></a><span>
</span><a name="line-227"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">bvdMaxBlockSize</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pos.Constants.html#genesisMaxBlockSize"><span class="hs-identifier hs-var">Const</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">genesisMaxBlockSize</span></a><span>
</span><a name="line-228"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">bvdMaxTxSize</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pos.Constants.html#genesisMaxTxSize"><span class="hs-identifier hs-var">Const</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">genesisMaxTxSize</span></a><span>
</span><a name="line-229"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">bvdMpcThd</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pos.Constants.html#genesisMpcThd"><span class="hs-identifier hs-var">Const</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">genesisMpcThd</span></a><span>
</span><a name="line-230"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">bvdHeavyDelThd</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pos.Constants.html#genesisHeavyDelThd"><span class="hs-identifier hs-var">Const</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">genesisHeavyDelThd</span></a><span>
</span><a name="line-231"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">bvdUpdateVoteThd</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pos.Constants.html#genesisUpdateVoteThd"><span class="hs-identifier hs-var">Const</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">genesisUpdateVoteThd</span></a><span>
</span><a name="line-232"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">bvdUpdateProposalThd</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pos.Constants.html#genesisUpdateProposalThd"><span class="hs-identifier hs-var">Const</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">genesisUpdateProposalThd</span></a><span>
</span><a name="line-233"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">bvdUpdateImplicit</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pos.Constants.html#genesisUpdateImplicit"><span class="hs-identifier hs-var">Const</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">genesisUpdateImplicit</span></a><span>
</span><a name="line-234"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">bvdUpdateSoftforkThd</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pos.Constants.html#genesisUpdateSoftforkThd"><span class="hs-identifier hs-var">Const</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">genesisUpdateSoftforkThd</span></a><span>
</span><a name="line-235"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-236"></a><span>
</span><a name="line-237"></a><span class="hs-comment">-- | ScriptVersion used at the very beginning</span><span>
</span><a name="line-238"></a><span class="hs-identifier">genesisScriptVersion</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ScriptVersion</span><span>
</span><a name="line-239"></a><a name="genesisScriptVersion"><a href="Pos.Genesis.html#genesisScriptVersion"><span class="hs-identifier">genesisScriptVersion</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-240"></a><span>
</span><a name="line-241"></a><span class="hs-comment">-- | Initial slot duration</span><span>
</span><a name="line-242"></a><span class="hs-identifier">genesisSlotDuration</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Millisecond</span><span>
</span><a name="line-243"></a><a name="genesisSlotDuration"><a href="Pos.Genesis.html#genesisSlotDuration"><span class="hs-identifier">genesisSlotDuration</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pos.Constants.html#genesisSlotDuration"><span class="hs-identifier hs-var">Const</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">genesisSlotDuration</span></a><span>
</span><a name="line-244"></a><span>
</span><a name="line-245"></a><span class="hs-comment">-- | Initial block size limit</span><span>
</span><a name="line-246"></a><span class="hs-identifier">genesisMaxBlockSize</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Byte</span><span>
</span><a name="line-247"></a><a name="genesisMaxBlockSize"><a href="Pos.Genesis.html#genesisMaxBlockSize"><span class="hs-identifier">genesisMaxBlockSize</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pos.Constants.html#genesisMaxBlockSize"><span class="hs-identifier hs-var">Const</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">genesisMaxBlockSize</span></a><span>
</span><a name="line-248"></a></pre></body></html>